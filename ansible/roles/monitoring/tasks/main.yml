---
- name: Install Docker
  apt:
    name: docker.io
    state: present
    update_cache: yes

- name: Install Docker Compose
  apt:
    name: docker-compose
    state: present

- name: Create monitoring directory
  file:
    path: /opt/monitoring
    state: directory

- name: Copy docker-compose.yml
  copy:
    dest: /opt/monitoring/docker-compose.yml
    content: |
      version: '3'
      services:
        prometheus:
          image: prom/prometheus
          ports:
            - "9090:9090"
        grafana:
          image: grafana/grafana
          ports:
            - "3000:3000"
        loki:
          image: grafana/loki
          ports:
            - "3100:3100"
        promtail:
          image: grafana/promtail
          volumes:
            - /var/log:/var/log

- name: Run Docker Compose
  community.docker.docker_compose:
    project_src: /opt/monitoring
    state: present
